#:import Animation kivy.animation.Animation
#:import MDProgressBar kivymd.progressbar.MDProgressBar
#:import MDSlider kivymd.slider.MDSlider
#:import MDList kivymd.list.MDList
#:import MDButton kivymd.button.MDRaisedButton

#:import math math

# Program Info
# ---------------------------------------------------------------------------------------------------------------------------------------------
# Created by Joel Zeller
# Edited by Charlie Howard & Nick Mantia

# Set Global Font Types to save typing later
#:set GaugeFont "data/fonts/digital-7 (mono).ttf"
#:set ButtonFont "data/fonts/Orbitron-Bold.ttf"

# Dock Y ZERO coordinate base. This will make it easier to fine tune the dock pos when installed behind radio opening.
#:set Dock_y0 7

AnchorLayout:
    ScreenManager:
        id: sm
        Gauge1Screen:
            name: "gauge1"
            FloatLayout:
                Image:
                    source: "data/wallpapers/digital_dash_background.png"
                
                # Current Gear
                Label:
                    text: app.currentgear
                    font_size: 300
                    size_hint: None, None
                    height: 280
                    width: 136
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 444, 33
                    font_name: GaugeFont
                    color: (232 / 255, 214 / 255, 7 / 255, 1)

                # Coolant Temp
                Image:
                    source: "data/gauges/warning/Coolant_red.png"
                    opacity: 1 if app.CoolantTemp > app.CoolantTempWarn else 0
                    pos: 849, 489
                    size_hint: None, None
                    height: 85
                    width: 120
                Image:
                    source: "data/gauges/Coolant_yellow.png"
                    opacity: 1 if app.CoolantTempWarn - (0.1875 * app.CoolantTempWarn) <= app.CoolantTemp <= app.CoolantTempWarn else 0
                    pos: 849, 489
                    size_hint: None, None
                    height: 85
                    width: 120
                Image:
                    source: "data/gauges/Coolant.png"
                    opacity: 1 if app.CoolantTemp <= app.CoolantTempWarn - (0.1875 * app.CoolantTempWarn) else 0
                    pos: 849, 489
                    size_hint: None, None
                    height: 85
                    width: 120
                Image:
                    source: str(app.CoolantTemp_Image)
                    opacity: 1
                    pos: 849, 489
                    size_hint: None, None
                    height: 85
                    width: 120
                    nocache: True

                # Fuel Level
                Image:
                    source: "data/gauges/FuelLevel.png"
                    opacity: 1
                    pos: 425, 290
                    size_hint: None, None
                    height: 251
                    width: 178
                Image:
                    source: str(app.FuelLevel_Image)
                    opacity: 1
                    pos: 425, 290
                    size_hint: None, None
                    height: 251
                    width: 178
                    nocache: True

                # Speed
                Image:
                    source: "data/gauges/MPH.png"
                    opacity: 1
                    pos: 42, 59
                    size_hint: None, None
                    height: 420
                    width: 320
                Image:
                    source: str(app.Speed_Image)
                    opacity: 1
                    pos: 42, 59
                    size_hint: None, None
                    height: 420
                    width: 320
                    nocache: True

                # RPM
                Image:
                    source: "data/gauges/RPM.png"
                    opacity: 1
                    pos: 658, 57
                    size_hint: None, None
                    height: 420
                    width: 320
                Image:
                    source: str(app.RPM_Image)
                    opacity: 1
                    pos: 658, 57
                    size_hint: None, None
                    height: 420
                    width: 320
                    nocache: True

                # Intake Temp
                Image:
                    source: "data/gauges/warning/IntakeTemp_red.png"
                    opacity: 1 if app.IntakeTemp > app.IntakeTempWarn else 0
                    pos: 234, 491
                    size_hint: None, None
                    height: 85
                    width: 120
                Image:
                    source: "data/gauges/IntakeTemp_yellow.png"
                    opacity: 1 if app.IntakeTempWarn - (0.1875 * app.IntakeTempWarn) <= app.IntakeTemp <= app.IntakeTempWarn else 0
                    pos: 234, 491
                    size_hint: None, None
                    height: 85
                    width: 120
                Image:
                    source: "data/gauges/IntakeTemp.png"
                    opacity: 1 if app.IntakeTemp <= app.IntakeTempWarn - (0.1875 * app.IntakeTempWarn) else 0
                    pos: 234, 491
                    size_hint: None, None
                    height: 85
                    width: 120
                Image:
                    source: str(app.IntakeTemp_Image)
                    opacity: 1
                    pos: 234, 491
                    size_hint: None, None
                    height: 85
                    width: 120
                    nocache: True

                Image:
                    source: "data/gauges/Voltage.png"
                    opacity: 1
                    pos: 657, 491
                    size_hint: None, None
                    height: 85
                    width: 150
                Image:
                    source: str(app.Voltage_Image)
                    opacity: 1
                    pos: 667, 491
                    size_hint: None, None
                    height: 85
                    width: 150
                    nocache: True

                Image:
                    source: "data/gauges/warning/LTFT_red.png"
                    opacity: 1 if app.LTFT > app.LTFTWarn else 0
                    pos: 45, 491
                    size_hint: None, None
                    height: 85
                    width: 145
                Image:
                    source: "data/gauges/LTFT_yellow.png"
                    opacity: 1 if app.LTFTWarn - (0.1875 * app.LTFTWarn) <= app.LTFT <= app.LTFTWarn else 0
                    pos: 45, 491
                    size_hint: None, None
                    height: 85
                    width: 145
                Image:
                    source: "data/gauges/LTFT.png"
                    opacity: 1 if app.LTFT <= app.LTFTWarn - (0.1875 * app.LTFTWarn) else 0
                    pos: 45, 491
                    size_hint: None, None
                    height: 85
                    width: 145
                Image:
                    source: str(app.LTFT_Image)
                    opacity: 1
                    pos: 55, 491
                    size_hint: None, None
                    height: 85
                    width: 145

                Label:
                    text:
                        (str(math.floor(app.CoolantTemp))) if app.TempUnit == "F" \
                        else (str(math.floor((app.CoolantTemp-32)*(5/9))))
                    font_size: 63
                    size_hint: None, None
                    height: 85
                    width: 120
                    text_size: self.width, None
                    halign: 'right'
                    valign: 'bottom'
                    font_hinting: None
                    pos: 839, 476
                    font_name: GaugeFont
                    color: (242 / 255, 109 / 255, 106 / 255, 1) if app.CoolantTemp > app.CoolantTempWarn else (232 / 255, 214 / 255, 7 / 255, 1) if app.CoolantTempWarn - (0.1875 * app.CoolantTempWarn) <= app.CoolantTemp <= app.CoolantTempWarn else (170 / 255, 229 / 255, 146 / 255, 1)  # Green
                Label:
                    text:
                        (str(math.floor(app.IntakeTemp))) if app.TempUnit == "F" \
                        else (str(math.floor((app.IntakeTemp-32)*(5/9))))
                    font_size: 63
                    size_hint: None, None
                    height: 85
                    width: 120
                    text_size: self.width, None
                    halign: 'right'
                    valign: 'bottom'
                    font_hinting: None
                    pos: 224, 476
                    font_name: GaugeFont
                    color: (242 / 255, 109 / 255, 106 / 255, 1) if app.IntakeTemp > app.IntakeTempWarn else (232 / 255, 214 / 255, 7 / 255, 1) if app.IntakeTempWarn - (0.1875 * app.IntakeTempWarn) <= app.IntakeTemp <= app.IntakeTempWarn else (170 / 255, 229 / 255, 146 / 255, 1)  # Green
                Label:
                    text: str(app.Voltage)
                    font_size: 63
                    size_hint: None, None
                    height: 85
                    width: 120
                    text_size: self.width, None
                    halign: 'right'
                    valign: 'bottom'
                    font_hinting: None
                    pos: 672, 476
                    font_name: GaugeFont
                    color: (242 / 255, 109 / 255, 106 / 255, 1) if app.Voltage > 16.25 else (232 / 255, 214 / 255, 7 / 255, 1) if app.IntakeTempWarn - (0.1875 * 16.25) <= app.IntakeTemp <= 16.25 else (170 / 255, 229 / 255, 146 / 255, 1)  # Green
                Label:
                    text: str(app.LTFT)
                    font_size: 63
                    size_hint: None, None
                    height: 85
                    width: 120
                    text_size: self.width, None
                    halign: 'right'
                    valign: 'bottom'
                    font_hinting: None
                    pos: 54, 476
                    font_name: GaugeFont
                    color: (242 / 255, 109 / 255, 106 / 255, 1) if app.LTFT > app.LTFTWarn else (232 / 255, 214 / 255, 7 / 255, 1) if app.LTFTWarn - (0.1875 * app.LTFTWarn) <= app.LTFT <= app.LTFTWarn else (170 / 255, 229 / 255, 146 / 255, 1)  # Green
                Label:
                    text:
                        str(math.floor(app.Speed)) if app.SpeedUnit == "MPH" \
                        else str(math.floor(app.Speed / 0.6213711922))
                    font_size: 99
                    size_hint: None, None
                    height: 85
                    width: 150
                    text_size: self.width, None
                    halign: 'right'
                    valign: 'middle'
                    font_hinting: None
                    pos: 188, 92
                    font_name: GaugeFont
                    color: (232 / 255, 214 / 255, 7 / 255, 1)
                Label:
                    text: str(math.floor(app.RPM/100))
                    font_size: 99
                    size_hint: None, None
                    height: 85
                    width: 150
                    text_size: self.width, None
                    halign: 'right'
                    valign: 'bottom'
                    font_hinting: None
                    pos: 777, 92
                    font_name: GaugeFont
                    color: (232 / 255, 214 / 255, 7 / 255, 1)

        Gauge2Screen:
            name: "gauge2"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"

                Image:
                    source: "data/gauges/warning/WarningRed.png"
                    opacity: 1 if app.CoolantTemp > app.CoolantTempWarn else 0
                    pos: 0, 250
                    size_hint: None, None
                    height: 250
                    width: 250

                Image:
                    source: "data/gauges/S2K_Coolant.png"
                    opacity: 1
                    pos: 0, 350
                    size_hint: None, None
                    height: 150
                    width: 250
                Image:
                    source: str(app.CoolantTemp_Image)
                    opacity: 1
                    pos: 0, 350
                    size_hint: None, None
                    height: 150
                    width: 250

                Image:
                    source: "data/gauges/warning/WarningRed.png"
                    opacity: 1 if abs(app.STFT) > app.STFTWarn else 0
                    pos: 275, 250
                    size_hint: None, None
                    height: 250
                    width: 250

                Image:
                    source: "data/gauges/S2K_STFT.png"
                    opacity: 1
                    pos: 275, 350
                    size_hint: None, None
                    height: 150
                    width: 250
                Image:
                    source: str(app.STFT_Image)
                    opacity: 1
                    pos: 275, 350
                    size_hint: None, None
                    height: 150
                    width: 250

                Image:
                    source: "data/gauges/S2K_LTFT.png"
                    opacity: 1
                    pos: 550, 350
                    size_hint: None, None
                    height: 150
                    width: 250
                Image:
                    source: str(app.LTFT_Image)
                    opacity: 1
                    pos: 550, 350
                    size_hint: None, None
                    height: 150
                    width: 250


                Label:
                    text:
                        (str(math.floor(app.CoolantTemp))) + u'\N{DEGREE SIGN}' if app.TempUnit == "F" \
                        else (str(math.floor((app.CoolantTemp-32)*(5/9)))) + u'\N{DEGREE SIGN}'
                    font_size: 70
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 0, 230
                    font_name: GaugeFont
                Label:
                    text: (str(app.STFT)) + "%"
                    font_size: 70
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 275, 230
                    font_name: GaugeFont
                Label:
                    text: (str(app.LTFT)) + "%"
                    font_size: 70
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 550, 230
                    font_name: GaugeFont

        Gauge3Screen:
            name: "gauge3"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"

                Image:
                    source: "data/gauges/S2K_Throttle.png"
                    opacity: 1
                    pos: 0, 350
                    size_hint: None, None
                    height: 150
                    width: 250
                Image:
                    source: str(app.ThrottlePos_Image)
                    opacity: 1
                    pos: 0, 350
                    size_hint: None, None
                    height: 150
                    width: 250

                Image:
                    source: "data/gauges/ThrottlePlate.png"
                    opacity: 1
                    pos: 89, 339
                    size_hint: None, None
                    height: 72
                    width: 72
                    canvas.before:
                        PushMatrix
                        Rotate:
                            angle: app.ThrottlePos
                            axis: 0, 0, 1
                            origin: self.center
                    canvas.after:
                        PopMatrix


                Image:
                    source: "data/gauges/S2K_Load.png"
                    opacity: 1
                    pos: 275, 350
                    size_hint: None, None
                    height: 150
                    width: 250
                Image:
                    source: str(app.Load_Image)
                    opacity: 1
                    pos: 275, 350
                    size_hint: None, None
                    height: 150
                    width: 250

                Image:
                    source: "data/gauges/S2K_Timing.png"
                    opacity: 1
                    pos: 550, 350
                    size_hint: None, None
                    height: 150
                    width: 250
                Image:
                    source: str(app.TimingAdv_Image)
                    opacity: 1
                    pos: 550, 350
                    size_hint: None, None
                    height: 150
                    width: 250

                Label:
                    text: (str(app.ThrottlePos)) + "%"
                    font_size: 70
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 0, 230
                    font_name: GaugeFont
                Label:
                    text: (str(app.Load)) + "%"
                    font_size: 70
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 275, 230
                    font_name: GaugeFont
                Label:
                    text: (str(app.TimingAdv)) + u'\N{DEGREE SIGN}'
                    font_size: 70
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 550, 230
                    font_name: GaugeFont

        Gauge4Screen:
            name: "gauge4"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"
                Label:
                    text:
                        str(math.floor(app.Speed)) if app.SpeedUnit == "MPH" \
                        else str(math.floor(app.Speed / 0.6213711922))
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: -270, 170
                    font_name: GaugeFont
                Label:
                    text: str(app.RPM)
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: -270, 60
                    font_name: GaugeFont
                Label:
                    text: app.SpeedUnit
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: -230, 153
                    font_name: GaugeFont
                Label:
                    text: "RPM"
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: -230, 43
                    font_name: GaugeFont
                Label:
                    text: app.currentgear
                    font_size: 175
                    size_hint: None, None
                    height: 150
                    width: 250
                    halign: 'center'
                    valign: 'middle'
                    font_hinting: None
                    pos: 480, 175
                    font_name: GaugeFont

        MaxScreen:
            name: "max"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"
                Label:
                    text:
                        str(math.floor(app.Speed)) if app.SpeedUnit == "MPH" \
                        else str(math.floor(app.Speed / 0.6213711922))
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: -270, 190
                    font_name: GaugeFont
                Label:
                    text: str(app.RPM)
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: -270, 80
                    font_name: GaugeFont
                Label:
                    text: app.SpeedUnit
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: -230, 173
                    font_name: GaugeFont
                Label:
                    text: "RPM"
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: -230, 63
                    font_name: GaugeFont

                Label:
                    text:
                        str(math.floor(app.Speed_max)) if app.SpeedUnit == "MPH" \
                        else str(math.floor(app.Speed_max / 0.6213711922))
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: 170, 190
                    font_name: GaugeFont
                Label:
                    text: str(app.RPM_max)
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 80
                    pos: 170, 80
                    font_name: GaugeFont
                Label:
                    text: app.SpeedUnit
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: 210, 173
                    font_name: GaugeFont

                Label:
                    text: "RPM"
                    text_size: 300, 100
                    halign: 'right'
                    valign: 'middle'
                    font_size: 15
                    pos: 210, 63
                    font_name: GaugeFont

                Label:
                    text: "CURRENT"
                    text_size: 400, 100
                    halign: 'center'
                    valign: 'middle'
                    font_size: 30
                    pos: -220, Dock_y0 - 150
                    font_name: GaugeFont
                Label:
                    text: "MAX"
                    text_size: 400, 100
                    halign: 'center'
                    valign: 'middle'
                    font_size: 30
                    pos: 220, Dock_y0 - 150
                    font_name: GaugeFont

                Button:
                    background_normal: 'data/elements/MaxIcons/Reset.png'
                    background_down: 'data/elements/MaxIcons/Reset_pressed.png'
                    opacity: 1
                    pos: 365, Dock_y0+70
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.zero_out_max()

        InfoScreen:
            name: "info"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"

                Label:
                    text: "SSID: " + app.WifiNetwork
                    text_size: 280, 50
                    halign: 'left'
                    valign: 'middle'
                    font_size: 20
                    pos: -250, 213
                    font_name: GaugeFont
                Label:
                    text: "IP: " + app.ipAddress
                    text_size: 280, 50
                    halign: 'left'
                    valign: 'middle'
                    font_size: 20
                    pos: -250, 183
                    font_name: GaugeFont
                Label:
                    text:
                        "CPU Temp: " + str(app.CPUTemp) + u'\N{DEGREE SIGN}' + "C" if app.TempUnit == "C" \
                        else "CPU Temp: " + str(math.floor(app.CPUTemp*9/5+32)) + u'\N{DEGREE SIGN}' + "F"
                    text_size: 280, 50
                    halign: 'left'
                    valign: 'middle'
                    font_size: 20
                    pos: -250, 153
                    font_name: GaugeFont
                    color: (1,0,0,1) if app.CPUTemp > 70 else (1,1,1,1)
                Label:
                    text: "CPU Core Voltage: " + str(app.CPUVolts) + "V"
                    text_size: 280, 50
                    halign: 'left'
                    valign: 'middle'
                    font_size: 20
                    pos: -250, 123
                    font_name: GaugeFont
                Label:
                    text: "DRDS Version: " + str(app.version)
                    text_size: 280, 50
                    halign: 'left'
                    valign: 'middle'
                    font_size: 20
                    pos: -250, 93
                    font_name: GaugeFont


        SettingsScreen:
            name: "settings"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"
                Button:
                    background_normal: 'data/elements/Apps/Warnings.png'
                    background_down: 'data/elements/Apps/Warnings_pressed.png'
                    opacity: 1
                    pos: 0, 380
                    size_hint: None, None
                    height: 100
                    width: 100
                    on_press: sm.current = 'tempsettings'
                Button:
                    background_normal: 'data/elements/Apps/OBDreset.png'
                    background_down: 'data/elements/Apps/OBDreset_pressed.png'
                    opacity: 1
                    pos: 100, 380
                    size_hint: None, None
                    height: 100
                    width: 100
                    on_press:
                        app.OBDOFF()
                        app.initOBD()
                Button:
                    background_normal: 'data/elements/Apps/CEL.png'
                    background_down: 'data/elements/Apps/CEL_pressed.png'
                    opacity: 1
                    pos: 200, 380
                    size_hint: None, None
                    height: 100
                    width: 100
                    on_press:
                        app.OBDOFF()
                        sm.transition.direction = 'left'
                        sm.current = 'DTC'

                Button:
                    background_normal: 'data/elements/Apps/raspberry.png'
                    background_down: 'data/elements/Apps/raspberry.png'
                    opacity: 1
                    pos: 300, 380
                    size_hint: None, None
                    height: 100
                    width: 100
                    on_press:
                        app.OBDOFF()
                        sm.transition.direction = 'left'
                        sm.current = 'info'

                Button:
                    background_normal: 'data/elements/Apps/C.png' if app.TempUnit == "C" else 'data/elements/Apps/F.png'
                    background_down: 'data/elements/Apps/C_pressed.png' if app.TempUnit == "C" else 'data/elements/Apps/F_pressed.png'
                    opacity: 1
                    pos: 0, 280
                    size_hint: None, None
                    height: 100
                    width: 100
                    on_release: app.toggleTempUnit()
                Button:
                    background_normal: 'data/elements/Apps/KPH.png' if app.SpeedUnit == 'KPH' else 'data/elements/Apps/MPH.png'
                    background_down: 'data/elements/Apps/KPH_pressed.png' if app.SpeedUnit == 'KPH' else 'data/elements/Apps/MPH_pressed.png'
                    opacity: 1
                    pos: 100, 280
                    size_hint: None, None
                    height: 100
                    width: 100
                    on_release: app.toggleSpeedUnit()

                Button:
                    background_normal: 'data/elements/Settings/ExitApp.png'
                    background_down: 'data/elements/Settings/ExitApp_pressed.png'
                    opacity: 1
                    pos: 730, 300
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.save()
                    on_release: app.killapp()

                Button:
                    background_normal: 'data/elements/Settings/Reboot.png'
                    background_down: 'data/elements/Settings/Reboot_pressed.png'
                    opacity: 1
                    pos: 730, 230
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.save()
                    on_release: app.reboot()

                Button:
                    background_normal: 'data/elements/Settings/Update.png'
                    background_down: 'data/elements/Settings/Update.png'
                    opacity: 1
                    pos: 730, 370
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press: app.save()
                    on_release: app.update()



        TempSettingsScreen:
            name: "tempsettings"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"
                Label:
                    text: "WARNING THRESHOLDS"
                    font_size: 25
                    pos: 0, 220
                    font_name: ButtonFont

                Button:
                    background_normal: 'data/elements/Settings/Left.png'
                    background_down: 'data/elements/Settings/Left_pressed.png'
                    opacity: 1
                    pos: 0, 320
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press:
                        sm.transition.direction = 'right'
                        sm.current = 'speedsettings'

                Button:
                    background_normal: 'data/elements/Settings/Right.png'
                    background_down: 'data/elements/Settings/Right_pressed.png'
                    opacity: 1
                    pos: 730, 320
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'fuelsettings'

                MDSlider:
                    pos: 230, 400
                    min: 0
                    max: app.CoolantTempGaugeMax
                    value: app.CoolantTempWarn
                    on_value: app.CoolantTempWarnSlider(*args)
                    size_hint: None, None
                    height: 50
                    width: 500
                Label:
                    text:
                        (str(app.CoolantTempWarn)) + u'\N{DEGREE SIGN}' if app.TempUnit == "F" \
                        else (str(math.floor((app.CoolantTempWarn-32)*(5/9)))) + u'\N{DEGREE SIGN}'
                    font_size: 30
                    pos: -210, 190
                    text_size: 100, 50
                    halign: 'right'
                    font_name: GaugeFont
                Image:
                    source: 'data/gauges/icons/Coolant.png'
                    pos: 80, 390
                    size_hint: None, None
                    height: 70
                    width: 70
                MDSlider:
                    pos: 230, 330
                    min: 0
                    max: app.IntakeTempGaugeMax
                    value: app.IntakeTempWarn
                    on_value: app.IntakeTempWarnSlider(*args)
                    size_hint: None, None
                    height: 50
                    width: 500
                Label:
                    text:
                        (str(app.IntakeTempWarn)) + u'\N{DEGREE SIGN}' if app.TempUnit == "F" \
                        else (str(math.floor((app.IntakeTempWarn-32)*(5/9)))) + u'\N{DEGREE SIGN}'
                    font_size: 30
                    pos: -210, 120
                    text_size: 100, 50
                    halign: 'right'
                    font_name: GaugeFont
                Image:
                    source: 'data/gauges/icons/Intake.png'
                    pos: 80, 320
                    size_hint: None, None
                    height: 70
                    width: 70


        FuelSettingsScreen:
            name: "fuelsettings"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"
                Label:
                    text: "WARNING THRESHOLDS"
                    font_size: 25
                    pos: 0, 220
                    font_name: ButtonFont

                Button:
                    background_normal: 'data/elements/Settings/Left.png'
                    background_down: 'data/elements/Settings/Left_pressed.png'
                    opacity: 1
                    pos: 0, 320
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press:
                        sm.transition.direction = 'right'
                        sm.current = 'tempsettings'

                Button:
                    background_normal: 'data/elements/Settings/Right.png'
                    background_down: 'data/elements/Settings/Right_pressed.png'
                    opacity: 1
                    pos: 730, 320
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'speedsettings'

                MDSlider:
                    pos: 230, 400
                    min: 0
                    max: app.STFTGaugeMax
                    value: app.STFTWarn
                    on_value: app.STFTWarnSlider(*args)
                    size_hint: None, None
                    height: 50
                    width: 500
                Label:
                    text: u'\N{PLUS-MINUS SIGN}' + str(app.STFTWarn) + "%"
                    font_size: 30
                    pos: -210, 190
                    text_size: 100, 50
                    halign: 'right'
                    font_name: GaugeFont
                Image:
                    source: 'data/gauges/icons/STFT.png'
                    pos: 80, 390
                    size_hint: None, None
                    height: 70
                    width: 70
                MDSlider:
                    pos: 230, 330
                    min: 0
                    max: app.LTFTGaugeMax
                    value: app.LTFTWarn
                    on_value: app.LTFTWarnSlider(*args)
                    size_hint: None, None
                    height: 50
                    width: 500
                Label:
                    text: u'\N{PLUS-MINUS SIGN}' + str(app.LTFTWarn) + "%"
                    font_size: 30
                    pos: -210, 120
                    text_size: 100, 50
                    halign: 'right'
                    font_name: GaugeFont
                Image:
                    source: 'data/gauges/icons/LTFT.png'
                    pos: 80, 320
                    size_hint: None, None
                    height: 70
                    width: 70

        SpeedSettingsScreen:
            name: "speedsettings"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"
                Label:
                    text: "WARNING THRESHOLDS"
                    font_size: 25
                    pos: 0, 220
                    font_name: ButtonFont

                Button:
                    background_normal: 'data/elements/Settings/Left.png'
                    background_down: 'data/elements/Settings/Left_pressed.png'
                    opacity: 1
                    pos: 0, 320
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press:
                        sm.transition.direction = 'right'
                        sm.current = 'fuelsettings'

                Button:
                    background_normal: 'data/elements/Settings/Right.png'
                    background_down: 'data/elements/Settings/Right_pressed.png'
                    opacity: 1
                    pos: 730, 320
                    size_hint: None, None
                    height: 70
                    width: 70
                    on_press:
                        sm.transition.direction = 'left'
                        sm.current = 'tempsettings'

                MDSlider:
                    pos: 230, 400
                    min: 0
                    max: app.RPMGaugeMax
                    value: app.RPMWarn
                    on_value: app.RPMWarnSlider(*args)
                    size_hint: None, None
                    height: 50
                    width: 500
                Label:
                    text: str(app.RPMWarn)
                    font_size: 30
                    pos: -215, 190
                    text_size: 100, 50
                    halign: 'right'
                    font_name: GaugeFont
                Image:
                    source: 'data/gauges/icons/RPM.png'
                    pos: 80, 390
                    size_hint: None, None
                    height: 70
                    width: 70
                MDSlider:
                    pos: 230, 330
                    min: 0
                    max: app.SpeedGaugeMax
                    value: app.SpeedWarn
                    on_value: app.SpeedWarnSlider(*args)
                    size_hint: None, None
                    height: 50
                    width: 500
                Label:
                    text: str(app.SpeedWarn)
                    font_size: 30
                    pos: -215, 120
                    text_size: 100, 50
                    halign: 'right'
                    font_name: GaugeFont
                Image:
                    source: 'data/gauges/icons/Speed.png'
                    pos: 80, 320
                    size_hint: None, None
                    height: 70
                    width: 70

        DTCScreen:
            name: "DTC"
            FloatLayout:
                Image:
                    source: "data/wallpapers/MaxScreen.png"

                Button:
                    background_normal: "data/elements/DTCIcons/ReadDTC.png"
                    background_down: "data/elements/DTCIcons/ReadDTC_pressed.png"
                    size_hint: None, None
                    height: 100
                    width: 100
                    pos: 25, 365
                    on_press: app.ReadDTC()
                Button:
                    background_normal: "data/elements/DTCIcons/ClearDTC.png"
                    background_down: "data/elements/DTCIcons/ClearDTC_pressed.png"
                    size_hint: None, None
                    height: 100
                    width: 100
                    pos: 25, 265
                    on_press: app.ClearDTC()

                ScrollView:
                    size_hint: None, None
                    height: 300
                    width: 650
                    pos: 150, 180
                    do_scroll_y: True
                    GridLayout:  # Can handle 10 DTCs for now
                        size_hint_y: None
                        height: self.minimum_height
                        row_default_height: 50
                        cols:1
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC0
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC1
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC2
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC3
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC4
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC5
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC6
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC7
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC8
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53
                        Button:
                            background_normal: "data/elements/List/ListItem.png"
                            background_down: "data/elements/List/ListItem.png"
                            Label:
                                text: app.DTC9
                                text_size: 650, 50
                                valign: 'middle'
                                halign: 'left'
                                font_size: 20
                                font_name: GaugeFont
                                pos: self.parent.center_x - 50, self.parent.center_y - 53

                Image:
                    source: "data/elements/Gradient/gradient.png"
                Label:
                    text:
                        (str(app.DTCqty) + " DTCs") if app.DTCqty > 1 \
                        else (str(app.DTCqty) + " DTC") if app.DTCqty == 1 \
                        else (("0 DTCs") if app.DTCqty == 0 \
                        else "")
                    text_size: 150, 50
                    valign: 'middle'
                    halign: 'center'
                    font_size: 30
                    font_name: GaugeFont
                    pos: -325, 0

    AnchorLayout: #define the QUICKEYS area
        FloatLayout:
            Button:
                id: BrightnessRibbon_full
                background_normal: 'data/elements/BrightnessRibbon/Full.png'
                background_down: 'data/elements/BrightnessRibbon/Full_pressed.png'
                opacity: 1
                pos: 19, Dock_y0 - 100
                size_hint: None, None
                height: 70
                width: 70
                on_press: app.BrightnessSet(255)
                on_press:
                    Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_full)
                    Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_2third)
                    Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_1third)
                    Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon_low)
                    Animation(y=Dock_y0 - 300, duration=0).start(BrightnessRibbon_exit)
            Button:
                id: BrightnessRibbon_2third
                background_normal: 'data/elements/BrightnessRibbon/2third.png'
                background_down: 'data/elements/BrightnessRibbon/2third_pressed.png'
                opacity: 1
                pos: 19, Dock_y0 - 150
                size_hint: None, None
                height: 70
                width: 70
                on_press: app.BrightnessSet(150)
                on_press:
                    Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_full)
                    Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_2third)
                    Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_1third)
                    Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon_low)
                    Animation(y=Dock_y0 - 300, duration=0).start(BrightnessRibbon_exit)
            Button:
                id: BrightnessRibbon_1third
                background_normal: 'data/elements/BrightnessRibbon/1third.png'
                background_down: 'data/elements/BrightnessRibbon/1third_pressed.png'
                opacity: 1
                pos: 19, Dock_y0 - 200
                size_hint: None, None
                height: 70
                width: 70
                on_press: app.BrightnessSet(55)
                on_press:
                    Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_full)
                    Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_2third)
                    Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_1third)
                    Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon_low)
                    Animation(y=Dock_y0 - 300, duration=0).start(BrightnessRibbon_exit)
            Button:
                id: BrightnessRibbon_low
                background_normal: 'data/elements/BrightnessRibbon/Low.png'
                background_down: 'data/elements/BrightnessRibbon/Low_pressed.png'
                opacity: 1
                pos: 19, Dock_y0 - 250
                size_hint: None, None
                height: 70
                width: 70
                on_press: app.BrightnessSet(15)
                on_press:
                    Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_full)
                    Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_2third)
                    Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_1third)
                    Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon_low)
                    Animation(y=Dock_y0 - 300, duration=0).start(BrightnessRibbon_exit)


            Button:
                id: dock_brightness
                background_normal: 'data/elements/Dock/BrightnessButton.png'
                background_down: 'data/elements/Dock/BrightnessButton_pressed.png'
                opacity: 1
                pos: 19, Dock_y0
                size_hint: None, None
                height: 40
                width: 40
                on_press: app.save()
                on_press:
                    Animation(y=Dock_y0 + 250, duration=.2).start(BrightnessRibbon_full)
                    Animation(y=Dock_y0 + 200, duration=.2).start(BrightnessRibbon_2third)
                    Animation(y=Dock_y0 + 150, duration=.2).start(BrightnessRibbon_1third)
                    Animation(y=Dock_y0 + 100, duration=.2).start(BrightnessRibbon_low)
                    Animation(y=Dock_y0, duration=0).start(BrightnessRibbon_exit)

            Button:
                id: BrightnessRibbon_exit
                background_normal: 'data/elements/BrightnessRibbon/Exit.png'
                background_down: 'data/elements/BrightnessRibbon/Exit_pressed.png'
                opacity: 1
                pos: 19, Dock_y0 - 300
                size_hint: None, None
                height: 70
                width: 70
                on_press:
                    Animation(y=Dock_y0 - 100, duration=.2).start(BrightnessRibbon_full)
                    Animation(y=Dock_y0 - 150, duration=.2).start(BrightnessRibbon_2third)
                    Animation(y=Dock_y0 - 200, duration=.2).start(BrightnessRibbon_1third)
                    Animation(y=Dock_y0 - 250, duration=.2).start(BrightnessRibbon_low)
                    Animation(y=Dock_y0 - 300, duration=0).start(BrightnessRibbon_exit)

            Button:
                id: dock_settings
                background_normal: 'data/elements/Dock/SettingsButton.png'
                background_down: 'data/elements/Dock/SettingsButton_pressed.png'
                opacity: 1
                pos: 908, Dock_y0
                size_hint: None, None
                height: 40
                width: 40
                on_press: app.save()
                on_press: sm.current = 'settings'

            Button:
                id: dock_power
                background_normal: 'data/elements/Dock/PowerButton.png'
                background_down: 'data/elements/Dock/PowerButton_pressed.png'
                opacity: 1
                pos: 963, Dock_y0
                size_hint: None, None
                height: 40
                width: 40
                on_press: app.save()
                on_press: app.ScreenOnOff("OFF")
                on_release: app.shutdown()

            Button:
                id: dock_gauge1
                background_normal: 'data/elements/Dock/DockPill.png'
                background_down: 'data/elements/Dock/DockPill_pressed.png'
                opacity: 1
                pos: 207, Dock_y0
                size_hint: None, None
                height: 40
                width: 80
                on_press:
                    sm.transition.direction = 'left'
                    sm.current = 'gauge1'
                    app.OBDOFF()
                    app.OBDEnabler("CoolantTemp",1)
                    app.OBDEnabler("IntakeTemp",1)
                    app.OBDEnabler("Voltage",1)
                    app.OBDEnabler("Speed",1)
                    app.OBDEnabler("LTFT",1)
                    app.OBDEnabler("RPM",1)
                    app.OBDEnabler("Gear",1)
                    app.save()
                Label:
                    text: "1"
                    text_size: 80, 40
                    valign: 'middle'
                    halign: 'center'
                    font_size: 22
                    font_name: ButtonFont
                    pos: self.parent.center_x - 50, self.parent.center_y - 50

            Button:
                id: dock_gauge2
                background_normal: 'data/elements/Dock/DockPill.png'
                background_down: 'data/elements/Dock/DockPill_pressed.png'
                opacity: 1
                pos: 312, Dock_y0
                size_hint: None, None
                height: 40
                width: 80
                on_press:
                    sm.transition.direction = 'left'
                    sm.current = 'gauge2'
                    app.OBDOFF()
                    app.OBDEnabler("CoolantTemp",1)
                    app.OBDEnabler("STFT",1)
                    app.OBDEnabler("LTFT",1)
                    app.save()
                Label:
                    text: "2"
                    text_size: 80, 40
                    valign: 'middle'
                    halign: 'center'
                    font_size: 22
                    font_name: ButtonFont
                    pos: self.parent.center_x - 50, self.parent.center_y - 50

            Button:
                id: dock_gauge3
                background_normal: 'data/elements/Dock/DockPill.png'
                background_down: 'data/elements/Dock/DockPill_pressed.png'
                opacity: 1
                pos: 418, Dock_y0
                size_hint: None, None
                height: 40
                width: 80
                on_press:
                    sm.transition.direction = 'left'
                    sm.current = 'gauge3'
                    app.OBDOFF()
                    app.OBDEnabler("ThrottlePos",1)
                    app.OBDEnabler("Load",1)
                    app.OBDEnabler("TimingAdv",1)
                    app.save()
                Label:
                    text: "3"
                    text_size: 80, 40
                    valign: 'middle'
                    halign: 'center'
                    font_size: 22
                    font_name: ButtonFont
                    pos: self.parent.center_x - 50, self.parent.center_y - 50

            Button:
                id: dock_gauge4
                background_normal: 'data/elements/Dock/DockPill.png'
                background_down: 'data/elements/Dock/DockPill_pressed.png'
                opacity: 1
                pos: 523, Dock_y0
                size_hint: None, None
                height: 40
                width: 80
                on_press:
                    sm.transition.direction = 'left'
                    sm.current = 'gauge4'
                    app.OBDOFF()
                    app.OBDEnabler("Speed",1)
                    app.OBDEnabler("RPM",1)
                    app.OBDEnabler("Gear",1)
                    app.save()
                Label:
                    text: "4"
                    text_size: 80, 40
                    valign: 'middle'
                    halign: 'center'
                    font_size: 22
                    font_name: ButtonFont
                    pos: self.parent.center_x - 50, self.parent.center_y - 50

            Button:
                id: dock_max
                background_normal: 'data/elements/Dock/DockPill.png'
                background_down: 'data/elements/Dock/DockPill_pressed.png'
                opacity: 1
                pos: 629, Dock_y0
                size_hint: None, None
                height: 40
                width: 80
                on_press:
                    sm.transition.direction = 'left'
                    sm.current = 'max'
                    app.OBDOFF()
                    app.OBDEnabler("Speed",1)
                    app.OBDEnabler("RPM",1)
                    app.save()
                Label:
                    text: "MAX"
                    text_size: 80, 40
                    valign: 'middle'
                    halign: 'center'
                    font_size: 19
                    font_name: ButtonFont
                    pos: self.parent.center_x - 50, self.parent.center_y - 50

            Button:
                id: dock_CEL
                background_normal: 'data/elements/Dock/DockPill_CEL.png'
                background_down: 'data/elements/Dock/DockPill_CEL_pressed.png'
                opacity: 1
                pos: 735, Dock_y0
                size_hint: None, None
                height: 40
                width: 80
                on_press:
                    sm.transition.direction = 'left'
                    sm.current = 'DTC'
                    app.OBDOFF()
                    app.save()


